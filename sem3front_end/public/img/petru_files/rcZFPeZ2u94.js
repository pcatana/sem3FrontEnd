if (self.CavalryLogger) { CavalryLogger.start_js(["SoBoS"]); }

__d("NotificationUpNextStore",["Arbiter","CurrentUser","NotificationBucketStore","NotificationSeenState","NotificationStore","PageTransitions","URI"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h="notification-up-next-updated",i=60*60*24*3,j="notification_clicked",k=i,l=null,m=null,n=null,o=null,p=null,q=false,r={},s=function s(C){if(p){var D=c("NotificationBucketStore").getBucketListData().find(function(E){return E.bucketType===p});return D?D.ids:[]}return!c("NotificationBucketStore").isEmptyBucketListData()?c("NotificationBucketStore").getBucketListData().reduce(function(E,F){return E.concat(F.ids)},[]):Object.keys(c("NotificationStore").getAll(C))},t=function t(C,D){__p&&__p();var E=s(D),F=E.indexOf(C);if(F===-1)return null;var G=E.filter(function(I){return!r[I]}),H=G.slice(F+1).find(function(I){return!c("NotificationSeenState").isRead(I)});if(H)return H;return q?G.slice(0,F).find(function(I){return!c("NotificationSeenState").isRead(I)}):null},u=function u(C){if(Date.now()/1e3-C.creation_time>k)return false;return true},v=function v(C){var D=C.getQueryData(),E=D.notif_id;if(!E)return null;return c("CurrentUser").getID()+":"+E},w=function w(C){return C.getUnqualifiedURI().setQueryData({}).toString()==="/photo.php"||Object.prototype.hasOwnProperty.call(C.getQueryData(),"theater")};c("Arbiter").subscribe(j,function(C,D){var E=D.alertID,F=D.endpointConfig;n=E;l=t(n,F);m=l?s(F).indexOf(l):null;if(l)c("PageTransitions").registerHandler(x)});var x=function x(C){var D=v(C);if(!D||n!==D)return;if(w(C))return;if(o==="click")z();else c("PageTransitions").registerCompletionCallback(y)},y=function y(){if(!n)return;var C=c("PageTransitions").getNextURI(),D=v(C);if(n!==D)return;z()},z=function z(){n=null;if(l)r[l]=true;l&&A.inform(h,l)},A=new(c("Arbiter"))(),B={getNextUnread:function C(){if(!l)return null;var D=c("NotificationStore").getNotification(l);if(!D||!u(D))return null;return D},getNextUnreadID:function C(){return l},getNextUnreadRowIndex:function C(){return m},subscribe:function C(D){return A.subscribe(h,D)},setMaxAge:function C(D){k=D},setTriggerAction:function C(D){o=D},setSupportedBucketType:function C(D){p=D},setLooping:function C(D){q=D}};f.exports=B}),null);
__d("NotificationUpNextDialog.react",["cx","Arbiter","FunnelLogger","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","Link.react","NotificationListConfig","NotificationListItemContents.react","NotificationListItemReadToggle.react","NotificationSeenState","NotificationTracking","NotificationUpNextStore","NotificationURI","NotificationUserActions","React","SubscriptionsHandler","URI","XUIContextualDialog.react","XUIContextualDialogBody.react","ifRequired","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k="notification_clicked",l=0,m="WWW_NOTIFS_UP_NEXT_FUNNEL",n=["hide","fail_max_impressions","fail_notif_validation"];function o(){c("FunnelLogger").startFunnel(m);c("FunnelLogger").addFunnelTag(m,l)}function p(r){c("FunnelLogger").appendAction(m,r);if(n.indexOf(r)!==-1)c("FunnelLogger").endFunnel(m)}i=babelHelpers.inherits(q,c("React").Component);j=i&&i.prototype;function q(){__p&&__p();var r,s;for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=j.constructor).call.apply(r,[this].concat(u)),this.$NotificationUpNextDialog3=true,this.$NotificationUpNextDialog4=new(c("SubscriptionsHandler"))(),this.state={isRead:false,rowIndex:null,shown:false,notification:null},this.$NotificationUpNextDialog11=function(){this.$NotificationUpNextDialog12()}.bind(this),this.$NotificationUpNextDialog13=function(){this.$NotificationUpNextDialog9()}.bind(this),this.$NotificationUpNextDialog7=function(){this.$NotificationUpNextDialog14()}.bind(this),this.$NotificationUpNextDialog18=function(){__p&&__p();this.$NotificationUpNextDialog17();o();if(!this.$NotificationUpNextDialog20()){p("fail_max_impressions");return}var w=c("NotificationUpNextStore").getNextUnread();if(!w){p("fail_notif_validation");return}var x=c("NotificationUpNextStore").getNextUnreadRowIndex();p("show");this.setState({notification:w,rowIndex:x,isRead:c("NotificationSeenState").isRead(w.alert_id),shown:true});this.$NotificationUpNextDialog19()}.bind(this),this.$NotificationUpNextDialog9=function(){this.$NotificationUpNextDialog17();p("hide");this.setState({shown:false,notification:null})}.bind(this),this.$NotificationUpNextDialog21=function(){var w=this.state.notification;if(!w)return;p("click_notif");c("Arbiter").inform(k,{alertID:w.alert_id,endpointConfig:this.props.endpointConfig});this.$NotificationUpNextDialog9();c("NotificationUserActions").markNotificationsAsRead([w.alert_id],null)}.bind(this),this.$NotificationUpNextDialog11=function(){p("hover");this.$NotificationUpNextDialog12()}.bind(this),this.$NotificationUpNextDialog13=function(){this.$NotificationUpNextDialog19()}.bind(this),this.$NotificationUpNextDialog22=function(w){p("click_see_all");this.props.onFooterClick(w)}.bind(this),this.$NotificationUpNextDialog23=function(w){if(!w)this.$NotificationUpNextDialog9()}.bind(this),this.$NotificationUpNextDialog24=function(){__p&&__p();p("toggle_read");var w=this.state,x=w.notification,y=w.isRead;if(!x)return;var z=x.alert_id;c("NotificationUserActions").setNextIsFromReadButton(true);if(!y)c("NotificationUserActions").markNotificationsAsRead([z],null);else if(c("NotificationListConfig").canMarkUnread)c("NotificationUserActions").markNotificationsAsUnread([z],null);this.setState({isRead:!y})}.bind(this),s}q.prototype.$NotificationUpNextDialog6=function(){__p&&__p();this.$NotificationUpNextDialog5=c("NotificationUpNextStore").subscribe(this.$NotificationUpNextDialog7);this.$NotificationUpNextDialog4.addSubscriptions(this.$NotificationUpNextDialog5,c("Arbiter").subscribe("layer_shown",function(r,s){if(s&&s.type==="Jewel")if(this.$NotificationUpNextDialog8()){p("jewel_opened");this.$NotificationUpNextDialog9()}}.bind(this)));c("ifRequired")("ClientChromeStore",function(r){this.$NotificationUpNextDialog4.addSubscriptions({remove:r.subscribe(function(){var s=r.getState();if(s.bluebar.activeFlyout.type!=null)if(this.$NotificationUpNextDialog8()){p("jewel_opened");this.$NotificationUpNextDialog9()}}.bind(this))})}.bind(this))};q.prototype.$NotificationUpNextDialog10=function(){this.$NotificationUpNextDialog4&&this.$NotificationUpNextDialog4.release()};q.prototype.$NotificationUpNextDialog15=function(){var r=this.props.hideDelay;return r===-1?7500:r};q.prototype.$NotificationUpNextDialog16=function(){var r=this.props,s=r.hideDelay,t=r.hideOnBlur;return t?s!==-1:true};q.prototype.$NotificationUpNextDialog14=function(){this.$NotificationUpNextDialog17();var r=this.props.showDelay;this.$NotificationUpNextDialog1=c("setTimeoutAcrossTransitions")(this.$NotificationUpNextDialog18,r)};q.prototype.$NotificationUpNextDialog17=function(){if(this.$NotificationUpNextDialog1){clearTimeout(this.$NotificationUpNextDialog1);this.$NotificationUpNextDialog1=null}};q.prototype.$NotificationUpNextDialog19=function(){if(!this.$NotificationUpNextDialog16())return;this.$NotificationUpNextDialog12();this.$NotificationUpNextDialog2=c("setTimeoutAcrossTransitions")(this.$NotificationUpNextDialog9,this.$NotificationUpNextDialog15())};q.prototype.$NotificationUpNextDialog12=function(){if(this.$NotificationUpNextDialog2){clearTimeout(this.$NotificationUpNextDialog2);this.$NotificationUpNextDialog2=null}};q.prototype.$NotificationUpNextDialog20=function(){var r=this.props.maxImpressions;if(++l===r)this.$NotificationUpNextDialog5&&this.$NotificationUpNextDialog5.unsubscribe();return l<=r};q.prototype.$NotificationUpNextDialog8=function(){return this.state.shown};q.prototype.componentWillMount=function(){this.$NotificationUpNextDialog6()};q.prototype.componentWillUnmount=function(){this.$NotificationUpNextDialog10()};q.prototype.$NotificationUpNextDialog25=function(){var r=this.state,s=r.isRead,t=r.rowIndex,u=r.notification;if(!u)return;var v=c("NotificationURI").localize(new(c("URI"))(u.url)),w={ref:"notif_jewel",jewel:"notifications"},x=c("NotificationTracking").getTrackingString(u,t||0);return c("React").createElement("ul",{"data-gt":JSON.stringify(w)},c("React").createElement("li",{"data-gt":x,"data-alert-id":u.alert_id},c("React").createElement("div",{className:"_33c"+(!s?" _2qd6":"")},c("React").createElement("a",babelHelpers["extends"]({},u.primerAttributes,{href:v,role:"link",className:"_3fgk",onClick:this.$NotificationUpNextDialog21}),c("React").createElement(c("NotificationListItemContents.react"),{notification:u,noPhotoPreviews:true})),c("React").createElement("ul",{className:"_55mc"},c("React").createElement("li",{className:"_h_c"},this.$NotificationUpNextDialog26())))))};q.prototype.$NotificationUpNextDialog26=function(){var r=this.state.isRead;return c("React").createElement(c("NotificationListItemReadToggle.react"),{onToggleClick:this.$NotificationUpNextDialog24,isRead:r,canMarkUnread:c("NotificationListConfig").canMarkUnread})};q.prototype.render=function(){var r=this.state,s=r.notification,t=r.shown;if(!s)return null;var u=this.props,v=u.context,w=u.footer,x=u.hideOnBlur,y=u.title;return c("React").createElement(c("XUIContextualDialog.react"),{alignment:"right",autoFocus:false,behaviors:{LayerFadeOnShow:c("LayerFadeOnShow"),LayerFadeOnHide:c("LayerFadeOnHide"),LayerHideOnTransition:c("LayerHideOnTransition")},className:"_3fgl",context:v,dialogRole:"alert",hideOnBlur:x,focusContextOnHide:false,label:y,offsetY:-6,onToggle:this.$NotificationUpNextDialog23,position:"below",shown:t,width:250},c("React").createElement(c("XUIContextualDialogBody.react"),null,c("React").createElement("div",{onMouseEnter:this.$NotificationUpNextDialog11,onMouseLeave:this.$NotificationUpNextDialog13,onFocus:this.$NotificationUpNextDialog11,onBlur:this.$NotificationUpNextDialog13},c("React").createElement("h3",{className:"_3fgm"},y),c("React").createElement("div",{className:"_6296"},this.$NotificationUpNextDialog25()),c("React").createElement("div",{className:"_3fgo jewelFooter"},c("React").createElement(c("Link.react"),{role:"button",className:"seeMore",onClick:this.$NotificationUpNextDialog22},w)))))};f.exports=q}),null);